<!-- Create/Edit Client Modal -->
<div class="p-8 bg-white dark:bg-zinc-900">
  <!-- Header -->
  <div class="mb-8">
    <div
      class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"
    >
      <p class="text-sm text-blue-800 dark:text-blue-200">
        @if (isEditMode()) {
          <i class="pi pi-info-circle mr-2"></i>
          Actualice la información del cliente seleccionado. Los cambios se aplicarán inmediatamente
          después de guardar. Tenga en cuenta que algunos campos como el RFC podrían afectar
          integraciones existentes.
        } @else {
          <i class="pi pi-lightbulb mr-2"></i>
          Configure la información básica del nuevo cliente, incluyendo datos fiscales, contactos y
          período de suscripción. Todos los campos marcados con (*) son obligatorios.
        }
      </p>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="clientForm" (ngSubmit)="onSave()" class="space-y-6">
    <!-- Basic Client Information -->
    <div class="space-y-4">
      <h4
        class="text-lg font-medium text-zinc-900 dark:text-white border-b border-zinc-200 dark:border-zinc-700 pb-2"
      >
        Información Básica
      </h4>

      <!-- Grid for basic info -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Nombre del Cliente -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="name"
              formControlName="name"
              [class.ng-invalid]="isFieldInvalid('name')"
              autofocus
              class="w-full"
            />
            <label for="name">Nombre del Cliente *</label>
          </p-floatlabel>
          @if (isFieldInvalid('name')) {
            <small class="text-red-600 text-xs">{{ getFieldError('name') }}</small>
          }
        </div>

        <!-- Subdominio -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="subdomain"
              formControlName="subdomain"
              [class.ng-invalid]="isFieldInvalid('subdomain')"
              placeholder="subdominio.orcasns.com"
              class="w-full"
            />
            <label for="subdomain">Subdominio *</label>
          </p-floatlabel>
          @if (isFieldInvalid('subdomain')) {
            <small class="text-red-600 text-xs">{{ getFieldError('subdomain') }}</small>
          }
        </div>

        <!-- Razón Social -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="legalName"
              formControlName="legalName"
              [class.ng-invalid]="isFieldInvalid('legalName')"
              placeholder="ORCA Corporation S.A. de C.V."
              class="w-full"
            />
            <label for="legalName">Razón Social *</label>
          </p-floatlabel>
          @if (isFieldInvalid('legalName')) {
            <small class="text-red-600 text-xs">{{ getFieldError('legalName') }}</small>
          }
        </div>

        <!-- RFC -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="rfc"
              formControlName="rfc"
              [class.ng-invalid]="isFieldInvalid('rfc')"
              placeholder="ABC123456DEF"
              class="w-full"
            />
            <label for="rfc">RFC *</label>
          </p-floatlabel>
          @if (isFieldInvalid('rfc')) {
            <small class="text-red-600 text-xs">{{ getFieldError('rfc') }}</small>
          }
        </div>

        <!-- Nombre del Esquema -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="schemaName"
              formControlName="schemaName"
              [class.ng-invalid]="isFieldInvalid('schemaName')"
              placeholder="acme_corp"
              class="w-full"
            />
            <label for="schemaName">Nombre del Esquema *</label>
          </p-floatlabel>
          @if (isFieldInvalid('schemaName')) {
            <small class="text-red-600 text-xs">{{ getFieldError('schemaName') }}</small>
          }
        </div>

        <!-- Línea de Negocio -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <p-select
              id="businessLineId"
              formControlName="businessLineId"
              [options]="businessLineOptions()"
              [class.ng-invalid]="isFieldInvalid('businessLineId')"
              [autofocus]="false"
              [filter]="true"
              filterBy="label"
              [showClear]="true"
              class="w-full"
            />
            <label for="businessLineId">Línea de Negocio *</label>
          </p-floatlabel>
          @if (isFieldInvalid('businessLineId')) {
            <small class="text-red-600 text-xs">{{ getFieldError('businessLineId') }}</small>
          }
        </div>
      </div>

      <!-- Descripción (full width) -->
      <div class="space-y-2">
        <p-floatlabel variant="on">
          <textarea
            pInputTextarea
            id="description"
            formControlName="description"
            [class.ng-invalid]="isFieldInvalid('description')"
            rows="3"
            class="w-full resize-none"
          >
          </textarea>
          <label for="description">Descripción</label>
        </p-floatlabel>
        @if (isFieldInvalid('description')) {
          <small class="text-red-600 text-xs">{{ getFieldError('description') }}</small>
        }
      </div>
    </div>

    <!-- Subscription Information -->
    <div class="space-y-4">
      <h4
        class="text-lg font-medium text-zinc-900 dark:text-white border-b border-zinc-200 dark:border-zinc-700 pb-2"
      >
        Información de Suscripción
      </h4>

      <!-- Grid for subscription dates -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Fecha de Inicio -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <p-datepicker
              id="subscriptionStartDate"
              formControlName="subscriptionStartDate"
              [class.ng-invalid]="isFieldInvalid('subscriptionStartDate')"
              dateFormat="yy-mm-dd"
              class="w-full"
            ></p-datepicker>
            <label for="subscriptionStartDate">Fecha de Inicio *</label>
          </p-floatlabel>
          @if (isFieldInvalid('subscriptionStartDate')) {
            <small class="text-red-600 text-xs">{{ getFieldError('subscriptionStartDate') }}</small>
          }
        </div>

        <!-- Fecha de Fin -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <p-datepicker
              id="subscriptionEndDate"
              formControlName="subscriptionEndDate"
              [class.ng-invalid]="isFieldInvalid('subscriptionEndDate')"
              dateFormat="yy-mm-dd"
              class="w-full"
            ></p-datepicker>
            <label for="subscriptionEndDate">Fecha de Fin *</label>
          </p-floatlabel>
          @if (isFieldInvalid('subscriptionEndDate')) {
            <small class="text-red-600 text-xs">{{ getFieldError('subscriptionEndDate') }}</small>
          }
        </div>

        <!-- Usuario Responsable -->
        <div class="space-y-2 md:col-span-2">
          <p-floatlabel variant="on">
            <p-select
              id="responsibleUserId"
              formControlName="responsibleUserId"
              [options]="orcaUserOptions()"
              [filter]="true"
              filterBy="label"
              [showClear]="true"
              class="w-full"
            />
            <label for="responsibleUserId">Usuario Responsable</label>
          </p-floatlabel>
        </div>
      </div>
    </div>

    <!-- Legal Contact Information -->
    <div class="space-y-4">
      <h4
        class="text-lg font-medium text-zinc-900 dark:text-white border-b border-zinc-200 dark:border-zinc-700 pb-2"
      >
        Contacto Legal
      </h4>

      <!-- Grid for legal contact -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Nombre del Contacto Legal -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="legalContactName"
              formControlName="legalContactName"
              [class.ng-invalid]="isFieldInvalid('legalContactName')"
              placeholder="Juan Pérez"
              class="w-full"
            />
            <label for="legalContactName">Nombre</label>
          </p-floatlabel>
          @if (isFieldInvalid('legalContactName')) {
            <small class="text-red-600 text-xs">{{ getFieldError('legalContactName') }}</small>
          }
        </div>

        <!-- Email del Contacto Legal -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="legalContactEmail"
              formControlName="legalContactEmail"
              [class.ng-invalid]="isFieldInvalid('legalContactEmail')"
              type="email"
              placeholder="legal@empresa.com"
              class="w-full"
            />
            <label for="legalContactEmail">Email</label>
          </p-floatlabel>
          @if (isFieldInvalid('legalContactEmail')) {
            <small class="text-red-600 text-xs">{{ getFieldError('legalContactEmail') }}</small>
          }
        </div>

        <!-- Teléfono del Contacto Legal -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="legalContactPhone"
              formControlName="legalContactPhone"
              [class.ng-invalid]="isFieldInvalid('legalContactPhone')"
              type="tel"
              placeholder="+52 55 1234 5678"
              class="w-full"
            />
            <label for="legalContactPhone">Teléfono</label>
          </p-floatlabel>
          @if (isFieldInvalid('legalContactPhone')) {
            <small class="text-red-600 text-xs">{{ getFieldError('legalContactPhone') }}</small>
          }
        </div>
      </div>
    </div>

    <!-- Technical Contact Information -->
    <div class="space-y-4">
      <h4
        class="text-lg font-medium text-zinc-900 dark:text-white border-b border-zinc-200 dark:border-zinc-700 pb-2"
      >
        Contacto Técnico
      </h4>

      <!-- Grid for technical contact -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Nombre del Contacto Técnico -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="technicalContactName"
              formControlName="technicalContactName"
              [class.ng-invalid]="isFieldInvalid('technicalContactName')"
              placeholder="María García"
              class="w-full"
            />
            <label for="technicalContactName">Nombre</label>
          </p-floatlabel>
          @if (isFieldInvalid('technicalContactName')) {
            <small class="text-red-600 text-xs">{{ getFieldError('technicalContactName') }}</small>
          }
        </div>

        <!-- Email del Contacto Técnico -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="technicalContactEmail"
              formControlName="technicalContactEmail"
              [class.ng-invalid]="isFieldInvalid('technicalContactEmail')"
              type="email"
              placeholder="tech@empresa.com"
              class="w-full"
            />
            <label for="technicalContactEmail">Email</label>
          </p-floatlabel>
          @if (isFieldInvalid('technicalContactEmail')) {
            <small class="text-red-600 text-xs">{{ getFieldError('technicalContactEmail') }}</small>
          }
        </div>

        <!-- Teléfono del Contacto Técnico -->
        <div class="space-y-2">
          <p-floatlabel variant="on">
            <input
              pInputText
              id="technicalContactPhone"
              formControlName="technicalContactPhone"
              [class.ng-invalid]="isFieldInvalid('technicalContactPhone')"
              type="tel"
              placeholder="+52 55 9876 5432"
              class="w-full"
            />
            <label for="technicalContactPhone">Teléfono</label>
          </p-floatlabel>
          @if (isFieldInvalid('technicalContactPhone')) {
            <small class="text-red-600 text-xs">{{ getFieldError('technicalContactPhone') }}</small>
          }
        </div>
      </div>
    </div>

    <!-- Estado del Cliente (solo en modo edición) -->
    @if (isEditMode()) {
      <div class="flex items-center gap-3 p-4 bg-zinc-50 dark:bg-zinc-800 rounded-lg">
        <p-checkbox formControlName="isActive" [binary]="true" inputId="isActive"> </p-checkbox>
        <label
          for="isActive"
          class="text-sm font-medium text-zinc-700 dark:text-zinc-300 cursor-pointer"
        >
          Cliente activo
        </label>
        <span class="text-xs text-zinc-500 dark:text-zinc-400 ml-auto">
          Los clientes inactivos no pueden acceder al sistema
        </span>
      </div>
    }

    <!-- Action Buttons -->
    <div class="flex justify-end gap-3 pt-6 border-t border-zinc-200 dark:border-zinc-700">
      <p-button label="Cancelar" severity="secondary" (click)="onCancel()" [disabled]="isLoading()">
      </p-button>

      <p-button
        [label]="submitButtonText()"
        type="submit"
        severity="primary"
        [loading]="isLoading()"
        [disabled]="isLoading() || clientForm.invalid"
        icon="pi pi-check"
      >
      </p-button>
    </div>
  </form>
</div>
